<Window x:Class="RetirePlanner.AcquisitionTaxWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RetirePlanner"
        mc:Ignorable="d"
        Title="취득세 계산기" Height="720" Width="1100" WindowStartupLocation="CenterScreen">
    <Window.DataContext>
        <local:AcquisitionTaxViewModel/>
    </Window.DataContext>

    <Grid Margin="16" RowDefinitions="Auto,*,Auto">
        <!-- 입력 도움 -->
        <Border Padding="10" Background="#F7F7F7" CornerRadius="8" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="16">
                <TextBlock Text="입력: 구분(대분류/세부), 과세표준(원)" FontWeight="Bold"/>
                <Button Content="행 추가" Padding="12,4" Command="{Binding AddRowCommand}"/>
                <Button Content="선택 행 삭제" Padding="12,4" Command="{Binding RemoveRowCommand}"/>
                <CheckBox IsChecked="{Binding EnableGift12Rule}" Content="(선택) 조정대상지역 3억↑ 주택 증여 12% 특례 적용" />
            </StackPanel>
        </Border>

        <!-- 본문 표 -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding Items}"
                  SelectedItem="{Binding SelectedItem}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="False"
                  HeadersVisibility="Column"
                  RowHeaderWidth="0"
                  ColumnWidth="*">
            <DataGrid.Columns>

                <!-- 대분류 -->
                <DataGridComboBoxColumn Header="대분류"
                                        SelectedItemBinding="{Binding MainType, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                        Width="150">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding MainTypes, Source={x:Reference Name=MainComboSource}}"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding MainTypes, Source={x:Reference Name=MainComboSource}}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

                <!-- 세부(토지/토지 이외) -->
                <DataGridComboBoxColumn Header="세부"
                                        SelectedItemBinding="{Binding SubType, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                        Width="120">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding SubTypes, Source={x:Reference Name=SubComboSource}}"/>
                            <Setter Property="IsEnabled" Value="{Binding IsSubTypeEnabled}"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding SubTypes, Source={x:Reference Name=SubComboSource}}"/>
                            <Setter Property="IsEnabled" Value="{Binding IsSubTypeEnabled}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

                <!-- 과세표준 -->
                <DataGridTextColumn Header="과세표준(원)"
                                    Binding="{Binding TaxBase, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}}"
                                    Width="150"/>

                <!-- 자동 세율 표시 -->
                <DataGridTextColumn Header="취득세율(%)"
                                    Binding="{Binding RateAcq, StringFormat={}{0:N2}}"
                                    IsReadOnly="True" Width="100"/>
                <DataGridTextColumn Header="농특세율(%)"
                                    Binding="{Binding RateRural, StringFormat={}{0:N2}}"
                                    IsReadOnly="True" Width="100"/>
                <DataGridTextColumn Header="지방교육세율(%)"
                                    Binding="{Binding RateEdu, StringFormat={}{0:N2}}"
                                    IsReadOnly="True" Width="120"/>

                <!-- 금액 결과(읽기전용) -->
                <DataGridTextColumn Header="취득세(원)" Binding="{Binding TaxAcq, StringFormat={}{0:N0}}" IsReadOnly="True" />
                <DataGridTextColumn Header="농특세(원)" Binding="{Binding TaxRural, StringFormat={}{0:N0}}" IsReadOnly="True" />
                <DataGridTextColumn Header="지방교육세(원)" Binding="{Binding TaxEdu, StringFormat={}{0:N0}}" IsReadOnly="True" />
                <DataGridTextColumn Header="합계(원)" Binding="{Binding TaxTotal, StringFormat={}{0:N0}}" IsReadOnly="True" />
            </DataGrid.Columns>

            <!-- 콤보용 숨은 리소스 -->
            <DataGrid.Resources>
                <local:ComboSource x:Key="MainComboSource" x:Name="MainComboSource"/>
                <local:ComboSource x:Key="SubComboSource" x:Name="SubComboSource"/>
            </DataGrid.Resources>
        </DataGrid>

        <!-- 총합 -->
        <Border Grid.Row="2" Padding="12" Background="#FFFDF6" BorderBrush="#E7D9A8" BorderThickness="1" CornerRadius="8" Margin="0,10,0,0">
            <UniformGrid Columns="4" >
                <StackPanel>
                    <TextBlock Text="취득세 합계" />
                    <TextBlock Text="{Binding SumAcq, StringFormat={}{0:N0}}"
                               FontWeight="Bold" FontSize="16"/>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="농특세 합계" />
                    <TextBlock Text="{Binding SumRural, StringFormat={}{0:N0}}"
                               FontWeight="Bold" FontSize="16"/>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="지방교육세 합계" />
                    <TextBlock Text="{Binding SumEdu, StringFormat={}{0:N0}}"
                               FontWeight="Bold" FontSize="16"/>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="총 합계" />
                    <TextBlock Text="{Binding SumTotal, StringFormat={}{0:N0}}"
                               FontWeight="Bold" FontSize="18"/>
                </StackPanel>
            </UniformGrid>
        </Border>
    </Grid>
</Window>
