<Window x:Class="RetirePlanner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RetirePlanner"
        mc:Ignorable="d"
        Title="재무설계BOT - 은퇴설계(Prototype)" Height="780" Width="1100"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="16">
        <TabControl SelectedIndex="{Binding SelectedTabIndex}">
            <!-- 1단계: 입력 -->
            <TabItem Header="1단계 입력(수집·가정)" FontSize="16">
                <ScrollViewer VerticalScrollBarVisibility="Auto" FontSize="16">
                    <StackPanel Margin="8" Orientation="Vertical" >

                        <TextBlock Text="기본 가정" FontWeight="Bold" FontSize="18" Margin="0,0,0,8"/>
                        <UniformGrid Columns="4" Rows="3" Margin="0,0,0,12">
                            <StackPanel Margin="4">
                                <TextBlock Text="현재나이" FontSize="16"/>
                                <TextBox Text="{Binding CurrentAge, UpdateSourceTrigger=PropertyChanged}" FontSize="16" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="은퇴나이" FontSize="16"/>
                                <TextBox Text="{Binding RetirementAge, UpdateSourceTrigger=PropertyChanged}" FontSize="16" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="은퇴 후 기간(년)" FontSize="16"/>
                                <TextBox Text="{Binding RetirementYears, UpdateSourceTrigger=PropertyChanged}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="물가상승률(%)" FontSize="16"/>
                                <TextBox Text="{Binding InflationRatePct, UpdateSourceTrigger=PropertyChanged}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="적립기 세후수익률(%)" FontSize="16"/>
                                <TextBox Text="{Binding AccumReturnRatePct, UpdateSourceTrigger=PropertyChanged}" FontSize="16"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="은퇴기 세후수익률(%)" FontSize="16"/>
                                <TextBox Text="{Binding RetirementReturnRatePct, UpdateSourceTrigger=PropertyChanged}" FontSize="16"/>
                            </StackPanel>
                        </UniformGrid>

                        <Separator/>

                        <TextBlock Text="연간 목표 은퇴소득(오늘가치, 원)" FontWeight="Bold" FontSize="18" Margin="0,8,0,4"/>
                        <TextBox Text="{Binding TargetIncomeToday, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N0}}" FontSize="16"/>

                        <TextBlock Text="공적연금(은퇴시점 연간 수령예상액, 원) - 여러 개면 추가" FontWeight="Bold" FontSize="18" Margin="0,12,0,4"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="추가" Margin="0,0,6,0" Command="{Binding AddPensionCommand}" FontSize="16"/>
                            <Button Content="삭제" Command="{Binding RemovePensionCommand}" FontSize="16"/>
                        </StackPanel>
                        <DataGrid ItemsSource="{Binding PublicPensions}" SelectedItem="{Binding SelectedPension}"
                                  AutoGenerateColumns="False" CanUserAddRows="False" Height="160" FontSize="16">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="연금명" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="연간금액(원)" Binding="{Binding AnnualAmount, StringFormat={}{0:N0}}" Width="*" />
                                <DataGridTextColumn Header="비고" Binding="{Binding Note}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <TextBlock Text="은퇴자산(현재잔액/정기적립/수익률) - 순미래가치로 평가" FontWeight="Bold" FontSize="18" Margin="0,12,0,4"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="추가" Margin="0,0,6,0" Command="{Binding AddAssetCommand}" FontSize="16"/>
                            <Button Content="삭제" Command="{Binding RemoveAssetCommand}" FontSize="16" />
                        </StackPanel>
                        <DataGrid ItemsSource="{Binding RetirementAssets}" SelectedItem="{Binding SelectedAsset}"
                                  AutoGenerateColumns="False" CanUserAddRows="False" Height="220" FontSize="16">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="자산명" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="현재잔액(원)" Binding="{Binding CurrentBalance , StringFormat={}{0:N0}}" Width="*"/>
                                <DataGridTextColumn Header="연간적립(원)" Binding="{Binding AnnualContribution , StringFormat={}{0:N0}}" Width="*"/>
                                <DataGridTextColumn Header="세후수익률(%)" Binding="{Binding AfterTaxReturnPct}" Width="*"/>
                                <DataGridTextColumn Header="비고" Binding="{Binding Note}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                            <Button Content="계산하기" Padding="16,6" Command="{Binding CalculateCommand}"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 결과/계획 -->
            <TabItem Header="2~6단계 결과·계획" FontSize="16">
                <ScrollViewer VerticalScrollBarVisibility="Auto" FontSize="16">
                    <StackPanel Margin="8">
                        <TextBlock Text="핵심 요약" FontWeight="Bold" FontSize="18" Margin="0,0,0,8"/>
                        <UniformGrid Columns="2" Margin="0,0,0,8">
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="은퇴까지 남은 기간(년)"/><Run Text="  "/><Run Text="[ "/><Run Text="H"/><Run Text=" ]"/></TextBlock>
                                <TextBlock Text="{Binding Result.YearsToRetirement, StringFormat={}{0:N0}년}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="목표은퇴소득(은퇴시점가치/년)"/><Run Text=" ["/><Run Text=" "/><Run Text="A"/><Run Text=" "/><Run Text="]"/></TextBlock>
                                <TextBlock Text="{Binding Result.TargetIncomeAtRetirement, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="공적연금 합계(은퇴시점/년)"/><Run Text=" ["/><Run Text=" "/><Run Text="B"/><Run Text=" "/><Run Text="]"/></TextBlock>
                                <TextBlock Text="{Binding Result.TotalPublicPensionAtRet, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="연간 은퇴소득 부족액 "/><Run Text="[ "/><Run Text="C = "/><Run Text="A - B ]"/></TextBlock>
                                <TextBlock Text="{Binding Result.AnnualIncomeGap, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="총은퇴일시금(은퇴시점 현가)"/><Run Text=" ["/><Run Text=" D ="/><Run Text=" C * "/><Run Text="은퇴 후 기간"/><Run Text=" ]"/></TextBlock>
                                <TextBlock Text="{Binding Result.TotalLumpSumNeeded, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="은퇴자산 평가금액(순미래가치합)"/><Run Text=" [ "/><Run Text="E"/><Run Text=" ]"/></TextBlock>
                                <TextBlock Text="{Binding Result.AssetsFutureValue, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="추가 필요 은퇴일시금"/><Run Text=" [ "/><Run Text="F"/><Run Text=" ="/><Run Text=" D - E ]"/><Run Text=" "/></TextBlock>
                                <TextBlock Text="{Binding Result.AdditionalLumpSumNeeded, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock><Run Text="연간 은퇴저축액(역산)"/><Run Text=" [ G "/><Run Text="= F / "/><Run Text="H"/><Run Text=" "/><Run Text="]"/></TextBlock>
                                <TextBlock Text="{Binding Result.RequiredAnnualSaving, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                        </UniformGrid>

                        <Separator/>

                        <TextBlock Text="간단한 저축(투자) 계획 제안(초기버전)" FontWeight="Bold" FontSize="16" Margin="0,8,0,4"/>
                        <TextBlock TextWrapping="Wrap">
- 위험성향/한도 미반영: 연간 은퇴저축액을 월납 기준으로 나눈 권고치(월 = 연간/12) 표시
- 기본 자산배분(예시): TDF 유사 로직(은퇴 20년↑: 주식60/채권40, 10~19년: 50/50, 0~9년: 35/65)
                        </TextBlock>

                        <UniformGrid Columns="3" Margin="0,8,0,0">
                            <StackPanel Margin="4">
                                <TextBlock Text="권고 월 저축액"/>
                                <TextBlock Text="{Binding Result.RequiredMonthlySaving, StringFormat={}{0:N0} 원}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="권고 주식 비중"/>
                                <TextBlock Text="{Binding Result.EquityWeightDisplay}" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="권고 채권 비중"/>
                                <TextBlock Text="{Binding Result.BondWeightDisplay}" FontWeight="Bold"/>
                            </StackPanel>
                        </UniformGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                            <Button Content="입력값 수정" Padding="16,6" Command="{Binding GoToInputCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
